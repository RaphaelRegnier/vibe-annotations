<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo-and-title">
          <img src="../assets/icons/icon128.png" alt="Vibe Annotations" class="header-logo">
          <div class="title-section">
            <h1 class="title">Vibe Annotations</h1>
            <p class="subtitle" id="current-route"></p>
          </div>
        </div>
        <div class="header-actions">
          <button id="get-started-header-btn" class="icon-btn" title="Docs">
            <iconify-icon icon="heroicons-outline:book-open" width="16" height="16"></iconify-icon>
          </button>
          <button id="settings-btn" class="icon-btn" title="Settings">
            <iconify-icon icon="heroicons-outline:cog-6-tooth" width="16" height="16"></iconify-icon>
          </button>
        </div>
      </div>
    </header>
    
    <main class="main">
      <!-- Welcome Screen (when server not detected) -->
      <div id="welcome-screen" class="welcome-screen" style="display: none;">
        <div class="welcome-content">
          <div class="welcome-logo">
            <img src="../assets/icons/icon128.png" alt="Vibe Annotations" width="48" height="48">
          </div>
          <h2 class="welcome-title">Welcome to Vibe Annotations!</h2>
          <p class="welcome-description">
            Vibe Annotations gives your AI coding agent superpowers, allowing it to bulk-treat all your visual annotations across different pages, while minding responsiveness.
          </p>
          <button id="get-started-btn" class="primary-btn get-started-btn">
            Get started (1min)
          </button>
        </div>
      </div>

      <!-- Get Started Screen (setup instructions) -->
      <div id="get-started-screen" class="get-started-screen" style="display: none;">
        <div class="get-started-content">
          <div class="get-started-header">
            <button id="back-to-welcome-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>Get started (1min)</h2>
          </div>
          
          <div class="get-started-body">
            <div class="rich-text-content">
              <p>To read your annotations, your AI coding agent needs to communicate to an MCP + HTTP API server that will run on your local machine.</p>
              
              <h3>1. Start the server (automatically installs if needed):</h3>
              <div class="command-code">
                <code>npx vibe-annotations-server start</code>
                <button class="copy-btn" data-command="npx vibe-annotations-server start" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <h3>2. Connect your AI coding agent to the server:</h3>
              
              <!-- AI Agent Tabs -->
              <div class="agent-tabs">
                <div class="tab-buttons">
                  <button class="tab-btn active" data-agent="claude">Claude Code</button>
                  <button class="tab-btn" data-agent="cursor">Cursor</button>
                  <button class="tab-btn" data-agent="windsurf">Windsurf</button>
                  <button class="tab-btn" data-agent="vscode">VS Code</button>
                  <button class="tab-btn" data-agent="other">Other editors</button>
                </div>
                
                <!-- Claude Code Tab -->
                <div class="tab-content active" data-agent="claude">
                  <p>Go to your project directory and run:</p>
                  <div class="command-code">
                    <code>claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse</code>
                    <button class="copy-btn" data-command="claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse" title="Copy command">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                  <p>To verify your installation, run <code>/mcp</code> inside of Claude Code and you should see the vibe-annotations MCP server connected.</p>
                </div>
                
                <!-- Cursor Tab -->
                <div class="tab-content" data-agent="cursor">
                  <ol>
                    <li>Open Cursor → Settings → Cursor Settings</li>
                    <li>Go to the Tools & Integrations tab</li>
                    <li>Click + Add new global MCP server</li>
                    <li>Enter the following configuration and save:</li>
                  </ol>
                  <div class="command-code">
                    <code>{
  "mcpServers": {
    "vibe-annotations": {
      "url": "http://127.0.0.1:3846/sse"
    }
  }
}</code>
                    <button class="copy-btn" data-command='{"mcpServers":{"vibe-annotations":{"url":"http://127.0.0.1:3846/sse"}}}' title="Copy configuration">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                </div>
                
                <!-- Windsurf Tab -->
                <div class="tab-content" data-agent="windsurf">
                  <ol>
                    <li>Navigate to Windsurf → Settings → Advanced Settings</li>
                    <li>Scroll down to the Cascade section</li>
                    <li>Click "Add new server" or edit the raw JSON config file</li>
                    <li>Add the following configuration:</li>
                  </ol>
                  <div class="command-code">
                    <code>{
  "mcpServers": {
    "vibe-annotations": {
      "serverUrl": "http://127.0.0.1:3846/sse"
    }
  }
}</code>
                    <button class="copy-btn" data-command='{"mcpServers":{"vibe-annotations":{"serverUrl":"http://127.0.0.1:3846/sse"}}}' title="Copy configuration">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                  <p>Make sure to press the refresh button after adding the new MCP plugin.</p>
                </div>
                
                <!-- VS Code Tab -->
                <div class="tab-content" data-agent="vscode">
                  <ol>
                    <li>Install an AI extension that supports MCP (like GitHub Copilot Chat or Continue)</li>
                    <li>Go to Code → Settings → Settings or use the shortcut ⌘,</li>
                    <li>In the search bar, type "MCP"</li>
                    <li>Look for MCP server configurations in your AI extension settings</li>
                    <li>Add the following SSE configuration:</li>
                  </ol>
                  <div class="command-code">
                    <code>{
  "mcpServers": {
    "vibe-annotations": {
      "type": "sse",
      "url": "http://127.0.0.1:3846/sse"
    }
  }
}</code>
                    <button class="copy-btn" data-command='{"mcpServers":{"vibe-annotations":{"type":"sse","url":"http://127.0.0.1:3846/sse"}}}' title="Copy configuration">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                  <p><strong>Note:</strong> MCP support varies by AI extension. Check your extension's documentation for specific setup instructions.</p>
                </div>
                
                <!-- Other Editors Tab -->
                <div class="tab-content" data-agent="other">
                  <p>Other code editors and tools that support SSE (Server-Sent Events) can also connect to the Vibe Annotations MCP server.</p>
                  <p>If you're using a different editor or tool, check its documentation to confirm it supports SSE-based communication. If it does, you can manually add the server using this configuration:</p>
                  <div class="command-code">
                    <code>{
  "mcpServers": {
    "vibe-annotations": {
      "url": "http://127.0.0.1:3846/sse"
    }
  }
}</code>
                    <button class="copy-btn" data-command='{"mcpServers":{"vibe-annotations":{"url":"http://127.0.0.1:3846/sse"}}}' title="Copy configuration">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                  <p><strong>Note:</strong> The Vibe Annotations MCP server communicates over the SSE protocol. Use your editor's steps for setting up an SSE-compatible MCP server, and use the URL: <code>http://127.0.0.1:3846/sse</code></p>
                </div>
              </div>
              
              <h2>How it works</h2>
              <p>Vibe Annotations only works when your local server is on, and the project host is localhost, 127.0.0.1, 0.0.0.0, or *.local. It recognizes common localhost and HTML local files.</p>
              
              <h3>1. Click "Start annotating"</h3>
              <p>You will enter an inspection mode to drop annotations, super fast! To exit, press Esc or reopen the popup and click "Stop annotating".</p>
              
              <h3>2. Drop your annotations, minding responsiveness.</h3>
              <p>Each annotation saves the window size, so your AI coding agent will mind your breakpoints when working on your feedbacks. Example: If you want to change an H1 fontsize only on mobile, just adjust your window size directly on your browser, or devtools. You can also specify it in your annotation.</p>
              
              <p><strong>Pro tips:</strong></p>
              <ul>
                <li>You can edit, find and delete annotations in the extension popup.</li>
                <li>You can drop annotations on multiple pages and projects.</li>
              </ul>
              
              <h3>3. Ask your AI coding agent to read and implement your comments/feedbacks/annotations.</h3>
              <p>Your AI coding agent will automatically call the MCP tools, read your annotations, understand their context and implement changes unless they are unclear. Once treated, your AI coding agent will automatically delete the annotations forever, and you're ready for the next batch!</p>
              
              <p>You're done! Work faster than ever!</p>
              
              <h2>Useful tips</h2>
              
              <h3>1. Server commands</h3>
              <div class="command-code">
                <code>vibe-annotations-server --help</code>
                <button class="copy-btn" data-command="vibe-annotations-server --help" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <h3>2. Reconnect MCP</h3>
              <p>Your AI coding agent loads the MCPs only once upon start. If you restart your MCP server, you will have to kill and restart your AI coding agent session(s).</p>
              
              <h3>3. Clean uninstallation of Vibe Annotations</h3>
              <p>First remove the MCP server from your AI coding agent (command varies by agent):</p>
              
              <!-- Uninstall Commands for Different Agents -->
              <div class="agent-tabs">
                <div class="tab-buttons">
                  <button class="tab-btn active" data-agent="claude-uninstall">Claude Code</button>
                  <button class="tab-btn" data-agent="cursor-uninstall">Cursor</button>
                  <button class="tab-btn" data-agent="windsurf-uninstall">Windsurf</button>
                  <button class="tab-btn" data-agent="other-uninstall">Other editors</button>
                </div>
                
                <div class="tab-content active" data-agent="claude-uninstall">
                  <div class="command-code">
                    <code>claude mcp remove vibe-annotations</code>
                    <button class="copy-btn" data-command="claude mcp remove vibe-annotations" title="Copy command">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                </div>
                
                <div class="tab-content" data-agent="cursor-uninstall">
                  <p>Go to Cursor → Settings → Cursor Settings → Tools & Integrations tab and remove the vibe-annotations server from your configuration.</p>
                </div>
                
                <div class="tab-content" data-agent="windsurf-uninstall">
                  <p>Go to Windsurf → Settings → Advanced Settings → Cascade section and remove the vibe-annotations server from your MCP configuration.</p>
                </div>
                
                <div class="tab-content" data-agent="other-uninstall">
                  <p>Remove the vibe-annotations server from your editor's MCP configuration settings.</p>
                </div>
              </div>
              
              <p>Then uninstall the server (recommended):</p>
              <div class="command-code">
                <code>npx vibe-annotations-server uninstall</code>
                <button class="copy-btn" data-command="npx vibe-annotations-server uninstall" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <p><em>Note: This command stops the server, uninstalls it, and provides clear feedback.</em></p>
              
              <p>Remove the data file:</p>
              <div class="command-code">
                <code>rm -rf ~/.vibe-annotations</code>
                <button class="copy-btn" data-command="rm -rf ~/.vibe-annotations" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <p>Then delete the browser extension.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Setup Complete Screen -->
      <div id="setup-complete-screen" class="setup-complete-screen" style="display: none;">
        <div class="setup-complete-content">
          <div class="setup-complete-icon">
            <iconify-icon icon="heroicons:check-circle" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="setup-complete-title">✅ Setup Complete!</h2>
          <div class="server-info">
            <div class="server-status-indicator">
              <span class="status-label">Server Status:</span>
              <span id="server-running-status" class="status-online">✅ Running (:3846)</span>
            </div>
          </div>
          <p class="setup-complete-text">
            Ready to annotate! Start using annotation tools in your AI coding agent.
          </p>
          <div class="server-actions">
            <button id="view-logs-btn" class="secondary-btn">
              <iconify-icon icon="lucide:file-text" width="16" height="16"></iconify-icon>
              View Server Logs
            </button>
            <button id="restart-server-btn" class="secondary-btn">
              <iconify-icon icon="lucide:refresh-cw" width="16" height="16"></iconify-icon>
              Restart Server
            </button>
          </div>
        </div>
      </div>

      <!-- How It Works Screen -->
      <div id="how-it-works-screen" class="how-it-works-screen" style="display: none;">
        <div class="how-it-works-content">
          <div class="how-it-works-header">
            <button id="back-to-setup-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>How it Works</h2>
          </div>
          
          <div class="how-it-works-body">
            <div class="instruction-section">
              <h3>One-Time Setup:</h3>
              <ol class="instruction-list">
                <li>
                  <strong>Start the server (auto-installs if needed):</strong>
                  <div class="code-block">
                    <code>npx vibe-annotations-server start</code>
                  </div>
                  <p class="instruction-note">The server will run in the background globally</p>
                </li>
                <li>
                  <strong>Navigate to your project directory:</strong>
                  <div class="code-block">
                    <code>cd /path/to/your/project</code>
                  </div>
                  <p class="instruction-note">Go to the project where you want to use Vibe Annotations</p>
                </li>
                <li>
                  <strong>Connect your AI coding agent to the server:</strong>
                  <p class="instruction-note">Setup varies by AI coding agent. See the main setup instructions for detailed steps for Claude Code, Cursor, Windsurf, VS Code, and other editors.</p>
                </li>
                <li>
                  <strong>Start your AI coding agent in this project:</strong>
                  <p class="instruction-note">Launch your preferred AI coding agent from the project directory to begin using annotations.</p>
                </li>
              </ol>
            </div>
            
            <div class="instruction-section">
              <h3>Server Management:</h3>
              <div class="server-management">
                <div class="management-item">
                  <strong>To stop the server:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server stop</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To restart the server:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server restart</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To check if server is running:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server status</code>
                  </div>
                </div>
              </div>
              
              <div class="warning-note">
                <iconify-icon icon="lucide:alert-triangle" width="16" height="16"></iconify-icon>
                <span><strong>Important:</strong> If you stop the server, you must restart your AI coding agent to reconnect when you start it again.</span>
              </div>
            </div>
            
            <div class="instruction-section">
              <h3>Working with Different Projects:</h3>
              <ul class="instruction-list">
                <li>The server runs once globally and serves all projects</li>
                <li>For each new project, configure the MCP server connection in your AI coding agent (see main setup instructions for agent-specific steps)</li>
                <li>Start your AI coding agent from the project directory to use annotations in that specific project</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Ready Screen (when online with no annotations) -->
      <div id="ready-screen" class="ready-screen" style="display: none;">
        <div class="ready-content">
          <div class="ready-icon">
            <iconify-icon icon="heroicons:rocket-launch" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="ready-title">Ready for your annotations</h2>
          <p class="ready-text">
            Click the button below to launch inspection mode and add annotations for your AI coding agent.
          </p>
        </div>
      </div>

      <!-- Annotations List -->
      <div id="annotations-list" class="annotations-list"></div>

      <!-- Settings Screen -->
      <div id="settings-screen" class="settings-screen" style="display: none;">
        <div class="settings-content">
          <div class="settings-header">
            <button id="back-from-settings-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>Settings</h2>
          </div>
          
          <div class="settings-body">
            <div class="setting-group">
              <label for="theme-select">Theme</label>
              <div class="theme-select-wrapper">
                <select id="theme-select" class="theme-select">
                  <option value="system">System</option>
                  <option value="light">Light</option>
                  <option value="dark">Dark</option>
                </select>
              </div>
            </div>
            
            <div class="setting-group">
              <label for="screenshot-toggle">Enhanced Context</label>
              <div class="toggle-setting">
                <span class="toggle-description">Capture element screenshots</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="screenshot-toggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <p class="setting-note">Include visual context with annotations to help AI agents better identify elements</p>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <footer class="footer">
      <div class="footer-content">
        <button id="new-annotation-btn" class="primary-btn">
          <iconify-icon icon="lucide:plus" width="16" height="16"></iconify-icon>
          Start Annotating
        </button>
        <div class="footer-status">
          <div id="mcp-status" class="mcp-status" title="MCP Connection Status">
            <div class="status-indicator offline"></div>
            <span class="status-text">API offline</span>
          </div>
          <button id="refresh-status-btn" class="icon-btn" title="Refresh connection">
            <iconify-icon icon="heroicons-outline:arrow-path" width="16" height="16"></iconify-icon>
          </button>
        </div>
      </div>
    </footer>
  </div>
  <script src="iconify-icon.min.js"></script>
  <script src="themes.js"></script>
  <script src="popup.js"></script>
</body>
</html>
